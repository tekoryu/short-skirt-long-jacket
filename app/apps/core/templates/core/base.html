{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SEAG Digital{% endblock %}</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="{% static 'core/images/favicon.ico' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'core/images/favicon-16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'core/images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="48x48" href="{% static 'core/images/favicon-48x48.png' %}">
    <link rel="icon" type="image/png" sizes="64x64" href="{% static 'core/images/favicon-64x64.png' %}">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'core/css/main.css' %}?v=2.0" rel="stylesheet">
    
    <!-- Leaflet.js for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    {% block extra_css %}{% endblock %}
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Leaflet.js -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
</head>
<body x-data="{ darkMode: false }" :class="{ 'dark-mode': darkMode }">
    <div class="top-bar" x-data="{ userMenuOpen: false }">
        <div class="top-bar-left">
            <a href="{% url 'core:main' %}" class="project-title-link">
                <h1 class="project-title">
                    <img src="{% static 'core/images/seaf_favicon_white.png' %}" alt="SEAG Digital Logo" class="project-logo">
                    SEAG Digital
                </h1>
            </a>
        </div>
        <div class="top-bar-right">
            <!-- Dark Mode Toggle -->
            <button 
                @click="darkMode = !darkMode" 
                class="theme-toggle"
                :aria-label="darkMode ? 'Mudar para modo claro' : 'Mudar para modo escuro'"
            >
                <i class="fas" :class="darkMode ? 'fa-sun' : 'fa-moon'"></i>
            </button>
            
            <!-- User Menu -->
            <div class="user-menu" @click.away="userMenuOpen = false">
                <button 
                    class="user-menu-toggle" 
                    @click="userMenuOpen = !userMenuOpen"
                    :aria-expanded="userMenuOpen"
                >
                    <i class="fas fa-user-circle"></i>
                    <span class="user-name">Admin</span>
                    <i class="fas fa-chevron-down transition-transform" :class="{ 'rotate-180': userMenuOpen }"></i>
                </button>
                
                <div 
                    class="user-menu-dropdown" 
                    x-show="userMenuOpen"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    @click="userMenuOpen = false"
                >
                    <a href="{% url 'core:settings' %}" class="user-menu-item">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </a>
                    <a href="{% url 'admin:index' %}" class="user-menu-item">
                        <i class="fas fa-tools"></i>
                        <span>Admin</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Toast Notifications Container -->
    <div 
        x-data="{ 
            notifications: [],
            addNotification(message, type = 'info') {
                const id = Date.now();
                this.notifications.push({ id, message, type });
                setTimeout(() => {
                    this.notifications = this.notifications.filter(n => n.id !== id);
                }, 5000);
            }
        }"
        @notify.window="addNotification($event.detail.message, $event.detail.type)"
        class="toast-container"
    >
        <template x-for="notification in notifications" :key="notification.id">
            <div 
                class="toast"
                :class="`toast-${notification.type}`"
                x-show="true"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 transform translate-x-full"
                x-transition:enter-end="opacity-100 transform translate-x-0"
                x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 transform translate-x-0"
                x-transition:leave-end="opacity-0 transform translate-x-full"
            >
                <i class="fas" :class="{
                    'fa-check-circle': notification.type === 'success',
                    'fa-info-circle': notification.type === 'info',
                    'fa-exclamation-triangle': notification.type === 'warning',
                    'fa-times-circle': notification.type === 'error'
                }"></i>
                <span x-text="notification.message"></span>
            </div>
        </template>
    </div>

    <script src="{% static 'core/js/main.js' %}?v=2.0"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
